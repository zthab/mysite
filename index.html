<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Zahra Thabet</title>
  <meta name="description" content="Zahra Thabet - Economics PhD student at Stanford University. Research interests in IO, urban, and environmental economics.">
  <meta property="og:title" content="Zahra Thabet">
  <meta property="og:description" content="Economics PhD Student at Stanford University">
  <meta property="og:image" content="https://zahrathabet.com/og-image.png">
  <meta property="og:type" content="website">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:image" content="https://zahrathabet.com/og-image.png">

  <!-- Fonts (non-render-blocking) -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@500;600;700&family=EB+Garamond:ital,wght@0,400;1,400&family=JetBrains+Mono:wght@400&display=swap">
  <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@500;600;700&family=EB+Garamond:ital,wght@0,400;1,400&family=JetBrains+Mono:wght@400&display=swap" rel="stylesheet" media="print" onload="this.media='all'">

  <link rel="stylesheet" href="styles.css">
</head>
<body>

  <header class="site-header">
    <div class="header-content">
      <h1 class="site-title"><a href="index.html">Zahra Thabet</a></h1>
      <nav class="site-nav">
        <a href="index.html" class="active">Home</a>
        <a href="about.html">About</a>
        <a href="resources.html">Resources</a>
        <a href="zahra_thabet_cv.pdf">CV</a>
      </nav>
    </div>
  </header>

  <main>
    <div class="portal">

      <div class="illustration-frame">
        <a href="https://en.wikipedia.org/wiki/Apel%C2%B7les_Mestres" target="_blank" rel="noopener" class="illustration-link">
          <img src="Ilustración_de_Liliana_(1907),_de_Apeles_Mestres,_pg_92.svg" alt="Illustration by Apeles Mestres from Liliana (1907)" fetchpriority="high">
        </a>
      </div>

      <h2 class="portal-name">Zahra Thabet</h2>
      <p class="portal-title">Economics PhD Student · Stanford University · IO, Urban, Enviro</p>

      <div class="portal-links">
        <a href="zahra_thabet_cv.pdf">CV</a>
        <a href="https://twitter.com/zahra_thab">Twitter</a>
        <a href="https://linkedin.com/in/zthab">LinkedIn</a>
        <a href="https://github.com/zthab">GitHub</a>
      </div>

      <div class="currently-section">
        <div class="divider-stars"></div>

        <!-- iNaturalist Recent Observation -->
        <div class="curiosity-card" id="inaturalist-card">
          <img class="curiosity-image" id="inat-image" src="" alt="" loading="lazy">
          <p class="curiosity-label">Recently observed <span class="info-tooltip" data-tip="Pulled from my iNaturalist"></span></p>
          <p class="curiosity-title"><a href="" id="inat-link" target="_blank" rel="noopener"></a></p>
          <p class="curiosity-meta" id="inat-meta"></p>
        </div>
      </div>

    </div>
  </main>

  <footer class="site-footer">
    <div class="footer-ornament"></div>
  </footer>

  <script>
    // Fetch most recent iNaturalist observation (cached for 24 hours)
    async function fetchINaturalist() {
      const CACHE_KEY = 'inat_cache';
      const CACHE_DURATION = 24 * 60 * 60 * 1000; // 24 hours in ms

      // Check cache first
      const cached = localStorage.getItem(CACHE_KEY);
      if (cached) {
        const { data, timestamp } = JSON.parse(cached);
        if (Date.now() - timestamp < CACHE_DURATION) {
          displayObservation(data);
          return;
        }
      }

      // Fetch fresh data
      try {
        const response = await fetch('https://api.inaturalist.org/v1/observations?user_login=zahra_thabet&order=desc&order_by=observed_on&per_page=1');
        const data = await response.json();

        if (data.results && data.results.length > 0) {
          const obs = data.results[0];
          localStorage.setItem(CACHE_KEY, JSON.stringify({ data: obs, timestamp: Date.now() }));
          displayObservation(obs);
        }
      } catch (error) {
        console.log('Could not fetch iNaturalist data:', error);
        document.getElementById('inaturalist-card').style.display = 'none';
      }
    }

    function displayObservation(obs) {
      const taxon = obs.taxon;
      const photo = obs.photos && obs.photos[0];

      document.getElementById('inat-image').src = photo ? photo.url.replace('square', 'small') : '';
      document.getElementById('inat-image').alt = taxon ? taxon.preferred_common_name || taxon.name : 'Observation';

      const displayName = taxon ? (taxon.preferred_common_name || taxon.name) : 'Unknown species';
      document.getElementById('inat-link').textContent = displayName;

      const wikiName = taxon ? taxon.name.replace(/ /g, '_') : '';
      document.getElementById('inat-link').href = wikiName ? `https://en.wikipedia.org/wiki/${wikiName}` : '#';

      const fullLocation = obs.place_guess || '';
      const parts = fullLocation.split(',').map(p => p.trim());
      const location = parts.length > 3 ? parts.slice(-3).join(', ') : fullLocation;
      document.getElementById('inat-meta').textContent = location;
    }

    fetchINaturalist();
  </script>

</body>
</html>
